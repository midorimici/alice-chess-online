(()=>{"use strict";const t="rgb(30, 30, 30)",e=9/80;var n=function(){function t(t){this.v=t}return t.prototype.val=function(){return this.v},t.prototype.add=function(e){return Array.isArray(e)?new t([e[0]+this.v[0],e[1]+this.v[1]]):new t([e+this.v[0],e+this.v[1]])},t.prototype.mul=function(e){return new t([e*this.v[0],e*this.v[1]])},t.prototype.div=function(e){return new t([this.v[0]/e,this.v[1]/e])},t.prototype.quot=function(e){return new t([Math.floor(this.v[0]/e),Math.floor(this.v[1]/e)])},t}(),r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},i=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t};const a=function(){function a(t){this.imgs=new Map,this.canvass=t,this.ctxs=t.map((function(t){return t.getContext("2d")})),this.squareSize=t[0].width*e,this.margin=.05*t[0].width}return a.init=function(t){return e=this,n=void 0,l=function(){var e,n,i,l,u,c,s,f,h,d,y,v,p,m;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(g){switch(g.label){case 0:e=new a(t),n=[];try{for(i=r("WB"),l=i.next();!l.done;l=i.next()){u=l.value;try{for(p=void 0,c=r("NBRQKP"),s=c.next();!s.done;s=c.next())f=s.value,n.push([u,f])}catch(t){p={error:t}}finally{try{s&&!s.done&&(m=c.return)&&m.call(c)}finally{if(p)throw p.error}}}}catch(t){y={error:t}}finally{try{l&&!l.done&&(v=i.return)&&v.call(i)}finally{if(y)throw y.error}}return[4,Promise.all(n.map((function(t){var n=o(t,2),r=n[0],i=n[1];return e.loadImg(r,i)})))];case 1:for(h=g.sent(),d=0;d<12;d++)e.imgs.set(n[d].join(""),h[d]);return[2,e]}}))},new((i=void 0)||(i=Promise))((function(t,r){function o(t){try{u(l.next(t))}catch(t){r(t)}}function a(t){try{u(l.throw(t))}catch(t){r(t)}}function u(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(o,a)}u((l=l.apply(e,n||[])).next())}));var e,n,i,l},a.prototype.loadImg=function(t,e){return new Promise((function(n){var r=new Image;r.onload=function(){return n(r)},r.src="../static/img/"+t+e+".png"}))},a.prototype.drawImg=function(t,e,n){var r=this.squareSize;t.drawImage(e,0,0,e.width,e.height,this.margin+r*n[0],this.margin+r*n[1],r,r)},a.prototype.drawPiece=function(t,e,n){var r=t.split(",").map((function(t){return+t})),o=this.ctxs[1-r[0]],i=this.imgs.get(e);this.drawImg(this.ctxs[r[0]],i,[r[1],r[2]]),n&&(o.save(),o.globalAlpha=.2,this.drawImg(o,i,[r[1],r[2]]),o.restore())},a.prototype.clearCanvas=function(){for(var t=0;t<2;t++)this.ctxs[t].fillStyle="rgb(240, 227, 206)",this.ctxs[t].fillRect(0,0,this.canvass[t].width,this.canvass[t].height)},a.prototype.grid=function(e){var r=this.squareSize,o=[this.margin,this.margin];e.fillStyle="rgb(179, 147, 105)";for(var a=0;a<8;a++)for(var l=0;l<8;l++)(a+l)%2&&e.fillRect.apply(e,i(new n([a,l]).mul(r).add(o).val(),[r,r]));for(e.strokeStyle=t,e.lineWidth=2,e.beginPath(),a=0;a<=8;a++)e.moveTo.apply(e,i(new n(o).add([0,r*a]).val())),e.lineTo.apply(e,i(new n(o).add([8*r,r*a]).val()));for(a=0;a<=8;a++)e.moveTo.apply(e,i(new n(o).add([r*a,0]).val())),e.lineTo.apply(e,i(new n(o).add([r*a,8*r]).val()));e.closePath(),e.stroke()},a.prototype.board=function(e,n,i){var a,l,u,c;this.clearCanvas();var s=this.ctxs;try{for(var f=r(s),h=f.next();!h.done;h=f.next()){var d=h.value;this.grid(d);var y=this.squareSize/3;d.fillStyle=t,d.font=y+"px Meiryo",d.textAlign="center",d.textBaseline="middle";for(var v=0;v<8;v++)d.fillText(String.fromCodePoint(v+97),("W"===n?v+1:8-v)*this.squareSize,this.canvass[0].height-this.margin/2),d.fillText(""+(8-v),this.margin/2,("W"===n?v+1:8-v)*this.squareSize)}}catch(t){a={error:t}}finally{try{h&&!h.done&&(l=f.return)&&l.call(f)}finally{if(a)throw a.error}}try{for(var p=r(e.entries()),m=p.next();!m.done;m=p.next()){var g=o(m.value,2),b=g[0],w=g[1];this.drawPiece(b,w,i)}}catch(t){u={error:t}}finally{try{m&&!m.done&&(c=p.return)&&c.call(p)}finally{if(u)throw u.error}}},a.prototype.dest=function(t,e,o,a,l){var u,c,s=this.ctxs[t.side];try{for(var f=r(t.validMoves(e,o,a,l)),h=f.next();!h.done;h=f.next()){var d=h.value,y=new n(d).mul(this.squareSize).add(this.margin+this.squareSize/2).val();s.beginPath(),s.arc.apply(s,i(y,[this.squareSize/4,0,2*Math.PI])),s.fillStyle="rgb(121, 202, 68)",s.fill()}}catch(t){u={error:t}}finally{try{h&&!h.done&&(c=f.return)&&c.call(f)}finally{if(u)throw u.error}}},a.prototype.promotion=function(t,e){var n=this.ctxs[t],r=this.margin,o=this.squareSize;n.fillStyle="rgb(150, 150, 150)",n.fillRect(r+3*o/2,r+3*o,5*o,2*o),this.drawImg(n,this.imgs.get(e+"N"),[2,3.5]),this.drawImg(n,this.imgs.get(e+"B"),[3,3.5]),this.drawImg(n,this.imgs.get(e+"R"),[4,3.5]),this.drawImg(n,this.imgs.get(e+"Q"),[5,3.5])},a}(),l=function(){function t(t){this.squareSize=t.width*e,this.margin=.05*t.width}return t.prototype.getWindowPos=function(t){var e=t.target.getBoundingClientRect();return[t.clientX-e.left,t.clientY-e.top]},t.prototype.chcoord=function(t){return new n(t).add(-this.margin).quot(this.squareSize).val()},t.prototype.getCoord=function(t){return this.chcoord(this.getWindowPos(t))},t}();var u,c,s,f,h,d=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},y=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},v={W:"B",B:"W"},p=function(t){var e,n,r=t,o=new Map;try{for(var i=d(r.entries()),a=i.next();!a.done;a=i.next()){var l=y(a.value,2),u=l[0],c=l[1],s=y(u.split(",").map((function(t){return+t})),3),f=s[0],h=s[1],v=s[2];o.set(f+","+(7-h)+","+(7-v),c)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return o},m=function(t,e){var n,r,o,i,a,l,u,c=new Map;try{for(var s=d(e.entries()),f=s.next();!f.done;f=s.next()){var h=y(f.value,2),p=h[0];if((w=h[1])===t+"K"){u=p.split(",").map((function(t){return+t}));break}}}catch(t){n={error:t}}finally{try{f&&!f.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}try{for(var m=d(e.entries()),g=m.next();!g.done;g=m.next()){var b=y(g.value,2),w=(p=b[0],b[1]);if(u[0]===+p[0]&&w[0]!==t){var x=p.split(",").map((function(t){return+t}));c.set([x[1],x[2]],new B[w[1]](v[t],+p[0]))}}}catch(t){o={error:t}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(o)throw o.error}}try{for(var S=d(c.entries()),I=S.next();!I.done;I=S.next()){var E=y(I.value,2);if(p=E[0],~(w=E[1]).coveringSquares(p,e).map((function(t){return String(t)})).indexOf(String(u.slice(1))))return!0}}catch(t){a={error:t}}finally{try{I&&!I.done&&(l=S.return)&&l.call(S)}finally{if(a)throw a.error}}return!1},g=function(t,e,n,r,o,i){var a,l=function(t){var n=new Map(i),r=y(t.split(","),3),o=r[0],a=(r[1],r[2]);return n.set(t,e+"K"),n.delete(o+","+c(4)+","+a),n},u=function(t){var n,o;try{for(var i=d(t),a=i.next();!a.done;a=i.next()){var u=a.value;if(m(e,p(l(r+","+u+",7"))))return!1}}catch(t){n={error:t}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return!0},c=function(t){return"W"===e?t:7-t},s=t[e][n]&&!m(e,p(i))&&i.get(r+","+7*n+",7")===e+"R";return a=0===n?String(o)===c(2)+",7"&&!i.has(r+","+c(1)+",7")&&!i.has(r+","+c(2)+",7")&&!i.has(r+","+c(3)+",7")&&!i.has(1-r+","+c(2)+",7")&&!i.has(1-r+","+c(3)+",7")&&u([c(2),c(3)]):String(o)===c(6)+",7"&&!i.has(r+","+c(6)+",7")&&!i.has(r+","+c(5)+",7")&&!i.has(1-r+","+c(6)+",7")&&!i.has(1-r+","+c(5)+",7")&&u([c(6),c(5)]),s&&a},b=function(t,e,n,r){r.set(1-t+","+String(n),r.get(t+","+String(e))),r.delete(t+","+String(e)),r.delete(t+","+String(n))},w=(u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),x=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},S=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},I=function(){function t(t,e){this.color=t,this.side=e}return t.prototype.inBoard=function(t){return t[0]>=0&&t[0]<8&&t[1]>=0&&t[1]<8},t.prototype.legal=function(t,e){var n;return this.inBoard(t)&&void 0===e.get(1-this.side+","+String(t))&&!((null===(n=e.get(this.side+","+String(t)))||void 0===n?void 0:n[0])===this.color)},t.prototype.rider=function(t,e,n){var r,o,i=[];try{for(var a=x(e),l=a.next();!l.done;l=a.next())for(var u=S(l.value,2),c=u[0],s=u[1],f=t[0]+c,h=t[1]+s;this.inBoard([f,h]);){var d=n.get(this.side+","+f+","+h);if(!n.get(1-this.side+","+f+","+h)){if(d){if(d[0]!==this.color){i.push([f,h]);break}break}i.push([f,h])}f+=c,h+=s}}catch(t){r={error:t}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return i},t.prototype.validMoves=function(t,e,n,r){var o,i,a,l,u=[],c=this.coveringSquares(t,e);if("K"===this.abbr)try{for(var s=x([0,1]),f=s.next();!f.done;f=s.next()){var h=f.value,d="W"===this.color?0===h?[2,7]:[6,7]:0===h?[5,7]:[1,7];g(r,this.color,h,this.side,d,e)&&c.push(d)}}catch(t){o={error:t}}finally{try{f&&!f.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}n&&function(t,e,n,r,o,i){return"P"===n&&r===o&&!i.has(r+","+String(e))&&t[1]===e[1]+1&&1===Math.abs(t[0]-e[0])}(t,d=[7-n[1],7-n[2]-1],this.abbr,this.side,n[0],e)&&c.push(d);try{for(var y=x(c),v=y.next();!v.done;v=y.next()){var w=v.value,S=new Map(e);if("K"===this.abbr){var I=new Map(e);if(I.set(this.side+","+String(w),this.color+"K"),I.delete(this.side+","+String(t)),m(this.color,p(I)))continue}b(this.side,t,w,S),m(this.color,p(S))||u.push(w)}}catch(t){a={error:t}}finally{try{v&&!v.done&&(l=y.return)&&l.call(y)}finally{if(a)throw a.error}}return u},t}(),B={N:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="N",e}return w(e,t),e.prototype.coveringSquares=function(t,e){var r=this;return[[1,2],[2,1],[2,-1],[1,-2],[-1,-2],[-2,-1],[-2,1],[-1,2]].map((function(e){return new n(t).add(e).val()})).filter((function(t){return r.legal(t,e)}))},e}(I),B:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="B",e}return w(e,t),e.prototype.coveringSquares=function(t,e){return this.rider(t,[[1,1],[1,-1],[-1,-1],[-1,1]],e)},e}(I),R:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="R",e}return w(e,t),e.prototype.coveringSquares=function(t,e){return this.rider(t,[[1,0],[0,-1],[-1,0],[0,1]],e)},e}(I),Q:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="Q",e}return w(e,t),e.prototype.coveringSquares=function(t,e){return this.rider(t,[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]],e)},e}(I),K:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="K",e}return w(e,t),e.prototype.coveringSquares=function(t,e){var r=this;return[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]].map((function(e){return new n(t).add(e).val()})).filter((function(t){return r.legal(t,e)}))},e}(I),P:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="P",e}return w(e,t),e.prototype.coveringSquares=function(t,e){var r,o,i=[],a=new n(t).add([1,-1]).val();(null===(r=e.get(this.side+","+String(a)))||void 0===r?void 0:r[0])===v[this.color]&&i.push(a),a=new n(t).add([-1,-1]).val(),(null===(o=e.get(this.side+","+String(a)))||void 0===o?void 0:o[0])===v[this.color]&&i.push(a),a=new n(t).add([0,-1]).val(),!e.has(this.side+","+String(a))&&this.legal(a,e)&&i.push(a);var l=new n(t).add([0,-2]).val();return 6!==t[1]||e.has(this.side+","+String(a))||e.has(this.side+","+String(l))||!this.legal(l,e)||i.push(l),i},e}(I)},E=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function l(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}u((r=r.apply(t,e||[])).next())}))},T=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},k=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},q=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},M="/en/"===location.pathname,P=!1,C=Array.from(document.getElementsByClassName("canvas")),W=document.getElementById("game-message"),N=document.getElementById("mute-icon"),z=document.getElementById("eye-icon"),O=!0,R=!0,j=function(){return E(void 0,void 0,void 0,(function(){var t,e,n,r,o,i,l,u,s;return T(this,(function(f){switch(f.label){case 0:document.getElementById("settings").style.display="none",(t=document.getElementById("game-container")).style.display="flex",e=t.clientWidth,n=t.clientHeight,(e<n||n<720)&&(document.getElementById("logo").style.display="none",document.getElementById("info-icon").style.display="none",document.getElementsByTagName("footer")[0].style.display="none"),r=(.4*(e<n?n:e)).toString();try{for(o=k(C),i=o.next();!i.done;i=o.next())(l=i.value).setAttribute("width",r),l.setAttribute("height",r)}catch(t){u={error:t}}finally{try{i&&!i.done&&(s=o.return)&&s.call(o)}finally{if(u)throw u.error}}return[4,a.init(C)];case 1:return c=f.sent(),P=!0,[2]}}))}))},A=io("https://alice-chess-online.herokuapp.com"),K=document.getElementById("form");K.addEventListener("submit",(function(t){t.preventDefault();var e=new FormData(K),n={roomId:e.get("room"),role:e.get("role"),name:""===e.get("username")?M?"anonymous":"名無し":e.get("username")};s=n.role,f=n.name,A.emit("enter room",n)}),!1),A.on("room full",(function(t){document.getElementById("message").innerText=M?"The room "+t+" is full. You cannot join in as a player.":"ルーム "+t+" はいっぱいです。対戦者として参加することはできません。"})),A.on("no room",(function(t){document.getElementById("message").innerText=M?"No player is present in the room "+t+".":"ルーム "+t+" では対戦が行われていません。"})),A.on("wait opponent",(function(){P||j(),W.innerText=M?"Waiting for the opponent...":"対戦相手の入室を待っています..."}));var _=function(t){new Audio("../static/sounds/"+t+".wav").play()};A.on("game",(function(t,e,n,r,o,i,a,u){return E(void 0,void 0,void 0,(function(){var s,d,y,v,p,m,g,b,w,x,S,I,E,N,K,L;return T(this,(function(T){switch(T.label){case 0:return s=new Map(t),""===document.getElementById("user-names").innerText&&(v="W"===e?o:r,document.getElementById("user-names").innerText="↑ "+v+"\n↓ "+f),P?[3,2]:[4,j()];case 1:T.sent(),T.label=2;case 2:if(c.board(s,e,R),z.onclick=function(){return H(s,e)},n){W.innerText=M?"It's your turn.":"あなたの番です。",O||_("move"),p=function(t,n){var r=!1;h=new l(n),n.onclick=function(n){var o,i=h.getCoord(n);if((null===(o=s.get(t+","+String(i)))||void 0===o?void 0:o[0])===e){d=i;var l=new(0,B[s.get(t+","+String(i))[1]])(e,t);c.board(s,e,R),c.dest(l,d,s,a,u),r=!1}else if(!r&&s.has(t+","+String(d))&&(y=i,(l=new(0,B[s.get(t+","+String(d))[1]])(e,t)).validMoves(d,s,a,u).some((function(t){return String(t)===String(y)}))&&("P"===l.abbr&&0===y[1]?r=!0:(O||_("move"),A.emit("move piece",t,d,y)))),c.board(s,e,R),r){for(var f=["N","B","R","Q"],v=2;v<=5;v++)i[0]!==v||3!==i[1]&&4!==i[1]||(r=!1,O||_("move"),A.emit("move piece",t,d,y,f[v-2]));String(i)===String(y)?c.promotion(t,e):(r=!1,d=null)}else d=null}};try{for(m=k(C.entries()),g=m.next();!g.done;g=m.next())b=q(g.value,2),w=b[0],I=b[1],p(w,I)}catch(t){E={error:t}}finally{try{g&&!g.done&&(N=m.return)&&N.call(m)}finally{if(E)throw E.error}}}else{W.innerText=M?"It's your opponent's turn.":"相手の番です。";try{for(x=k(C),S=x.next();!S.done;S=x.next())(I=S.value).onclick=function(){}}catch(t){K={error:t}}finally{try{S&&!S.done&&(L=x.return)&&L.call(x)}finally{if(K)throw K.error}}}return i&&(W.innerHTML=(M?"Check!":"チェック！")+"<br>"+W.innerText,O||_("check")),[2]}}))}))})),A.on("watch",(function(t,e,n,r,o,i){return void 0===i&&(i=!1),E(void 0,void 0,void 0,(function(){var a,l;return T(this,(function(u){switch(u.label){case 0:return"watch"!==s?[3,3]:(a=new Map(t),""===document.getElementById("user-names").innerText&&(document.getElementById("user-names").innerText="↑ "+n+"\n↓ "+e),o&&(W.innerHTML=(M?"Check!":"チェック！")+"<br>"+W.innerText),P?[3,2]:[4,j()]);case 1:u.sent(),u.label=2;case 2:if(c.board(a,"W",R),z.onclick=function(){return H(a,"W")},i)return[2];l=0===r?e:n,W.innerText=M?"It's "+l+"'s turn.":l+" さんの番です。",O||_("move"),o&&(W.innerHTML=(M?"Check!":"チェック！")+"<br>"+W.innerText,O||_("check")),u.label=3;case 3:return[2]}}))}))})),A.on("tell winner",(function(t){void 0===t?W.innerText=M?"Draw!":"引き分け！":W.innerHTML=(M?"Checkmate!":"チェックメイト！")+"<br>"+(M?t+" won!":t+" の勝ち！"),O||_("win")})),A.on("player discon",(function(t){alert(M?t+"'s connection is closed.":t+" さんの接続が切れました。"),location.reload()})),N.onclick=function(){N.src=O?"../static/svg/volume-up-solid.svg":"../static/svg/volume-mute-solid.svg",N.title=O?M?"Mute":"ミュート":M?"Unmute":"ミュート解除",O=!O};var H=function(t,e){z.src=R?"../static/svg/eye-slash-regular.svg":"../static/svg/eye-regular.svg",z.title=R?M?"Show pieces in opposite board":"反対側の盤面の駒を表示する":M?"Hide pieces in opposite board":"反対側の盤面の駒を隠す",R=!R,c.board(t,e,R)};document.getElementById("info-icon").onclick=function(){document.getElementById("info-overlay").style.display="flex"},document.getElementById("close-icon").onclick=function(){document.getElementById("info-overlay").style.display="none"},function(t,e){var n=document.getElementById("chat-form"),r=document.getElementById("chat-input"),o=document.getElementById("chat-send-icon");n.addEventListener("submit",(function(e){e.preventDefault(),r.value&&(t.emit("chat message",r.value),r.value="")})),o.onclick=function(){r.value&&(t.emit("chat message",r.value),r.value="")};var i=document.getElementById("chat-messages"),a=document.getElementById("chat"),l=document.getElementById("chat-new");t.on("chat message",(function(t,n,r){var o=document.createElement("li"),u=document.createElement("span");if(u.className="chat-name",u.innerText=r,n){var c=document.createElement("img");c.className="chat-player-icon",c.src="../static/svg/ghost-solid.svg",c.alt="player-icon",c.title=e?"Player":"対戦者",u.appendChild(c)}o.appendChild(u);var s=document.createElement("span");s.innerText=t,o.appendChild(s),i.appendChild(o),i.scrollTop=i.scrollHeight,"closed"===a.className&&(l.className="")})),document.getElementById("chat-btn").onclick=function(){l.className="hidden",a.classList.toggle("closed")}}(A,M)})();