(()=>{"use strict";const t="rgb(30, 30, 30)",e=9/80;var n=function(){function t(t){this.v=t}return t.prototype.val=function(){return this.v},t.prototype.add=function(e){return Array.isArray(e)?new t([e[0]+this.v[0],e[1]+this.v[1]]):new t([e+this.v[0],e+this.v[1]])},t.prototype.mul=function(e){return new t([e*this.v[0],e*this.v[1]])},t.prototype.div=function(e){return new t([this.v[0]/e,this.v[1]/e])},t.prototype.quot=function(e){return new t([Math.floor(this.v[0]/e),Math.floor(this.v[1]/e)])},t}(),r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},i=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t};const a=function(){function a(t){this.imgs=new Map,this.canvass=t,this.ctxs=t.map((function(t){return t.getContext("2d")})),this.squareSize=t[0].width*e,this.margin=.05*t[0].width}return a.init=function(t){return e=this,n=void 0,l=function(){var e,n,o,l,u,c,s,f,d,h,y,v,p,m;return function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}(this,(function(g){switch(g.label){case 0:e=new a(t),n=[];try{for(o=r("WB"),l=o.next();!l.done;l=o.next()){u=l.value;try{for(p=void 0,c=r("NBRQKP"),s=c.next();!s.done;s=c.next())f=s.value,n.push([u,f])}catch(t){p={error:t}}finally{try{s&&!s.done&&(m=c.return)&&m.call(c)}finally{if(p)throw p.error}}}}catch(t){y={error:t}}finally{try{l&&!l.done&&(v=o.return)&&v.call(o)}finally{if(y)throw y.error}}return[4,Promise.all(n.map((function(t){var n=i(t,2),r=n[0],o=n[1];return e.loadImg(r,o)})))];case 1:for(d=g.sent(),h=0;h<12;h++)e.imgs.set(n[h].join(""),d[h]);return[2,e]}}))},new((o=void 0)||(o=Promise))((function(t,r){function i(t){try{u(l.next(t))}catch(t){r(t)}}function a(t){try{u(l.throw(t))}catch(t){r(t)}}function u(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(i,a)}u((l=l.apply(e,n||[])).next())}));var e,n,o,l},a.prototype.loadImg=function(t,e){return new Promise((function(n){var r=new Image;r.onload=function(){return n(r)},r.src="../static/img/"+t+e+".png"}))},a.prototype.drawImg=function(t,e,n){var r=this.squareSize;t.drawImage(e,0,0,e.width,e.height,this.margin+r*n[0],this.margin+r*n[1],r,r)},a.prototype.drawPiece=function(t,e,n){var r=t.split(",").map((function(t){return+t})),i=this.ctxs[1-r[0]],o=this.imgs.get(e);this.drawImg(this.ctxs[r[0]],o,[r[1],r[2]]),n&&(i.save(),i.globalAlpha=.2,this.drawImg(i,o,[r[1],r[2]]),i.restore())},a.prototype.clearCanvas=function(){for(var t=0;t<2;t++)this.ctxs[t].fillStyle="rgb(240, 227, 206)",this.ctxs[t].fillRect(0,0,this.canvass[t].width,this.canvass[t].height)},a.prototype.grid=function(e){var r=this.squareSize,i=[this.margin,this.margin];e.fillStyle="rgb(179, 147, 105)";for(var a=0;a<8;a++)for(var l=0;l<8;l++)(a+l)%2&&e.fillRect.apply(e,o(new n([a,l]).mul(r).add(i).val(),[r,r]));for(e.strokeStyle=t,e.lineWidth=2,e.beginPath(),a=0;a<=8;a++)e.moveTo.apply(e,o(new n(i).add([0,r*a]).val())),e.lineTo.apply(e,o(new n(i).add([8*r,r*a]).val()));for(a=0;a<=8;a++)e.moveTo.apply(e,o(new n(i).add([r*a,0]).val())),e.lineTo.apply(e,o(new n(i).add([r*a,8*r]).val()));e.closePath(),e.stroke()},a.prototype.board=function(e,n,o){var a,l,u,c;this.clearCanvas();var s=this.ctxs;try{for(var f=r(s),d=f.next();!d.done;d=f.next()){var h=d.value;this.grid(h);var y=this.squareSize/3;h.fillStyle=t,h.font=y+"px Meiryo",h.textAlign="center",h.textBaseline="middle";for(var v=0;v<8;v++)h.fillText(String.fromCodePoint(v+97),("W"===n?v+1:8-v)*this.squareSize,this.canvass[0].height-this.margin/2),h.fillText(""+(8-v),this.margin/2,("W"===n?v+1:8-v)*this.squareSize)}}catch(t){a={error:t}}finally{try{d&&!d.done&&(l=f.return)&&l.call(f)}finally{if(a)throw a.error}}try{for(var p=r(e.entries()),m=p.next();!m.done;m=p.next()){var g=i(m.value,2),b=g[0],w=g[1];this.drawPiece(b,w,o)}}catch(t){u={error:t}}finally{try{m&&!m.done&&(c=p.return)&&c.call(p)}finally{if(u)throw u.error}}},a.prototype.dest=function(t,e,i,a,l){var u,c,s=this.ctxs[t.side];try{for(var f=r(t.validMoves(e,i,a,l)),d=f.next();!d.done;d=f.next()){var h=d.value,y=new n(h).mul(this.squareSize).add(this.margin+this.squareSize/2).val();s.beginPath(),s.arc.apply(s,o(y,[this.squareSize/4,0,2*Math.PI])),s.fillStyle="rgb(121, 202, 68)",s.fill()}}catch(t){u={error:t}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(u)throw u.error}}},a.prototype.promotion=function(t,e){var n=this.ctxs[t],r=this.margin,i=this.squareSize;n.fillStyle="rgb(150, 150, 150)",n.fillRect(r+3*i/2,r+3*i,5*i,2*i),this.drawImg(n,this.imgs.get(e+"N"),[2,3.5]),this.drawImg(n,this.imgs.get(e+"B"),[3,3.5]),this.drawImg(n,this.imgs.get(e+"R"),[4,3.5]),this.drawImg(n,this.imgs.get(e+"Q"),[5,3.5])},a}(),l=function(){function t(t){this.squareSize=t.width*e,this.margin=.05*t.width}return t.prototype.getWindowPos=function(t){var e=t.target.getBoundingClientRect();return[t.clientX-e.left,t.clientY-e.top]},t.prototype.chcoord=function(t){return new n(t).add(-this.margin).quot(this.squareSize).val()},t.prototype.getCoord=function(t){return this.chcoord(this.getWindowPos(t))},t}();var u,c,s,f,d=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},h=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},y={W:"B",B:"W"},v=function(t){var e,n,r=t,i=new Map;try{for(var o=d(r.entries()),a=o.next();!a.done;a=o.next()){var l=h(a.value,2),u=l[0],c=l[1],s=h(u.split(",").map((function(t){return+t})),3),f=s[0],y=s[1],v=s[2];i.set(f+","+(7-y)+","+(7-v),c)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return i},p=function(t,e){var n,r,i,o,a,l,u,c=new Map;try{for(var s=d(e.entries()),f=s.next();!f.done;f=s.next()){var v=h(f.value,2),p=v[0];if((w=v[1])===t+"K"){u=p.split(",").map((function(t){return+t}));break}}}catch(t){n={error:t}}finally{try{f&&!f.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}try{for(var m=d(e.entries()),g=m.next();!g.done;g=m.next()){var b=h(g.value,2),w=(p=b[0],b[1]);if(u[0]===+p[0]&&w[0]!==t){var x=p.split(",").map((function(t){return+t}));c.set([x[1],x[2]],new B[w[1]](y[t],+p[0]))}}}catch(t){i={error:t}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}try{for(var S=d(c.entries()),I=S.next();!I.done;I=S.next()){var E=h(I.value,2);if(p=E[0],~(w=E[1]).coveringSquares(p,e).map((function(t){return String(t)})).indexOf(String(u.slice(1))))return!0}}catch(t){a={error:t}}finally{try{I&&!I.done&&(l=S.return)&&l.call(S)}finally{if(a)throw a.error}}return!1},m=function(t,e,n,r,i,o){var a,l=function(t){var n=new Map(o),r=h(t.split(","),3),i=r[0],a=(r[1],r[2]);return n.set(t,e+"K"),n.delete(i+","+c(4)+","+a),n},u=function(t){var n,i;try{for(var o=d(t),a=o.next();!a.done;a=o.next()){var u=a.value;if(p(e,v(l(r+","+u+",7"))))return!1}}catch(t){n={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return!0},c=function(t){return"W"===e?t:7-t},s=t[e][n]&&!p(e,v(o))&&o.get(r+","+7*n+",7")===e+"R";return a=0===n?String(i)===c(2)+",7"&&!o.has(r+","+c(1)+",7")&&!o.has(r+","+c(2)+",7")&&!o.has(r+","+c(3)+",7")&&!o.has(1-r+","+c(2)+",7")&&!o.has(1-r+","+c(3)+",7")&&u([c(2),c(3)]):String(i)===c(6)+",7"&&!o.has(r+","+c(6)+",7")&&!o.has(r+","+c(5)+",7")&&!o.has(1-r+","+c(6)+",7")&&!o.has(1-r+","+c(5)+",7")&&u([c(6),c(5)]),s&&a},g=function(t,e,n,r){r.set(1-t+","+String(n),r.get(t+","+String(e))),r.delete(t+","+String(e)),r.delete(t+","+String(n))},b=(u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),w=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},x=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},S=function(){function t(t,e){this.color=t,this.side=e}return t.prototype.inBoard=function(t){return t[0]>=0&&t[0]<8&&t[1]>=0&&t[1]<8},t.prototype.legal=function(t,e){var n;return this.inBoard(t)&&void 0===e.get(1-this.side+","+String(t))&&!((null===(n=e.get(this.side+","+String(t)))||void 0===n?void 0:n[0])===this.color)},t.prototype.rider=function(t,e,n){var r,i,o=[];try{for(var a=w(e),l=a.next();!l.done;l=a.next())for(var u=x(l.value,2),c=u[0],s=u[1],f=t[0]+c,d=t[1]+s;this.inBoard([f,d]);){var h=n.get(this.side+","+f+","+d);if(!n.get(1-this.side+","+f+","+d)){if(h){if(h[0]!==this.color){o.push([f,d]);break}break}o.push([f,d])}f+=c,d+=s}}catch(t){r={error:t}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},t.prototype.validMoves=function(t,e,n,r){var i,o,a,l,u=[],c=this.coveringSquares(t,e);if("K"===this.abbr)try{for(var s=w([0,1]),f=s.next();!f.done;f=s.next()){var d=f.value,h="W"===this.color?0===d?[2,7]:[6,7]:0===d?[5,7]:[1,7];m(r,this.color,d,this.side,h,e)&&c.push(h)}}catch(t){i={error:t}}finally{try{f&&!f.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}n&&function(t,e,n,r,i,o){return"P"===n&&r===i&&!o.has(r+","+String(e))&&t[1]===e[1]+1&&1===Math.abs(t[0]-e[0])}(t,h=[7-n[1],7-n[2]-1],this.abbr,this.side,n[0],e)&&c.push(h);try{for(var y=w(c),b=y.next();!b.done;b=y.next()){var x=b.value,S=new Map(e);if("K"===this.abbr){var B=new Map(e);if(B.set(this.side+","+String(x),this.color+"K"),B.delete(this.side+","+String(t)),p(this.color,v(B)))continue}g(this.side,t,x,S),p(this.color,v(S))||u.push(x)}}catch(t){a={error:t}}finally{try{b&&!b.done&&(l=y.return)&&l.call(y)}finally{if(a)throw a.error}}return u},t}(),B={N:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="N",e}return b(e,t),e.prototype.coveringSquares=function(t,e){var r=this;return[[1,2],[2,1],[2,-1],[1,-2],[-1,-2],[-2,-1],[-2,1],[-1,2]].map((function(e){return new n(t).add(e).val()})).filter((function(t){return r.legal(t,e)}))},e}(S),B:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="B",e}return b(e,t),e.prototype.coveringSquares=function(t,e){return this.rider(t,[[1,1],[1,-1],[-1,-1],[-1,1]],e)},e}(S),R:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="R",e}return b(e,t),e.prototype.coveringSquares=function(t,e){return this.rider(t,[[1,0],[0,-1],[-1,0],[0,1]],e)},e}(S),Q:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="Q",e}return b(e,t),e.prototype.coveringSquares=function(t,e){return this.rider(t,[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]],e)},e}(S),K:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="K",e}return b(e,t),e.prototype.coveringSquares=function(t,e){var r=this;return[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]].map((function(e){return new n(t).add(e).val()})).filter((function(t){return r.legal(t,e)}))},e}(S),P:function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.abbr="P",e}return b(e,t),e.prototype.coveringSquares=function(t,e){var r,i,o=[],a=new n(t).add([1,-1]).val();(null===(r=e.get(this.side+","+String(a)))||void 0===r?void 0:r[0])===y[this.color]&&o.push(a),a=new n(t).add([-1,-1]).val(),(null===(i=e.get(this.side+","+String(a)))||void 0===i?void 0:i[0])===y[this.color]&&o.push(a),a=new n(t).add([0,-1]).val(),!e.has(this.side+","+String(a))&&this.legal(a,e)&&o.push(a);var l=new n(t).add([0,-2]).val();return 6!==t[1]||e.has(this.side+","+String(a))||e.has(this.side+","+String(l))||!this.legal(l,e)||o.push(l),o},e}(S)},I=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function l(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}u((r=r.apply(t,e||[])).next())}))},E=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},T=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},k=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},q="/en/"===location.pathname,M=!1,P=Array.from(document.getElementsByClassName("canvas")),C=document.getElementById("game-message"),N=document.getElementById("mute-icon"),W=document.getElementById("eye-icon"),z=!0,O=!0,R=function(){return I(void 0,void 0,void 0,(function(){var t,e,n,r,i,o,l,u,s;return E(this,(function(f){switch(f.label){case 0:document.getElementById("settings").style.display="none",(t=document.getElementById("game-container")).style.display="flex",e=t.clientWidth,n=t.clientHeight,(e<n||n<720)&&(document.getElementById("logo").style.display="none",document.getElementById("info-icon").style.display="none",document.getElementsByTagName("footer")[0].style.display="none"),r=(.4*(e<n?n:e)).toString();try{for(i=T(P),o=i.next();!o.done;o=i.next())(l=o.value).setAttribute("width",r),l.setAttribute("height",r)}catch(t){u={error:t}}finally{try{o&&!o.done&&(s=i.return)&&s.call(i)}finally{if(u)throw u.error}}return[4,a.init(P)];case 1:return c=f.sent(),M=!0,[2]}}))}))},j=io("https://alice-chess-online.herokuapp.com"),A=document.getElementsByName("visibility"),K=document.getElementById("room-key"),_=document.getElementById("room-input");A[0].checked&&(K.style.visibility="hidden",_.required=!1);for(var H=function(t){A[t].onclick=function(){K.style.visibility=0===t?"hidden":"visible",_.required=1===t}},L=0;L<=1;L++)H(L);var Q,D=document.getElementById("form");D.addEventListener("submit",(function(t){t.preventDefault();var e=new FormData(D),n={private:"private"===e.get("visibility"),roomId:e.get("room"),role:e.get("role"),name:""===e.get("username")?q?"anonymous":"名無し":e.get("username")};s=n.role,f=n.name,j.emit("enter room",n)}),!1),j.on("room full",(function(t){document.getElementById("message").innerText=q?"The room "+t+" is full. You cannot join in as a player.":"ルーム "+t+" はいっぱいです。対戦者として参加することはできません。"})),j.on("no private room",(function(t){document.getElementById("message").innerText=q?"No player is present in the room "+t+".":"ルーム "+t+" では対戦が行われていません。"})),j.on("no public room",(function(){document.getElementById("message").innerText=q?"No player is present in public rooms.":"パブリックルームでは対戦が行われていません。"})),j.on("wait opponent",(function(){M||R(),C.innerText=q?"Waiting for the opponent...":"対戦相手の入室を待っています..."})),j.on("audience i/o",(function(t){document.getElementById("watcher-number").innerText=String(t)}));var G=function(t){new Audio("../static/sounds/"+t+".wav").play()};j.on("game",(function(t,e,n,r,i,o,a,u){return I(void 0,void 0,void 0,(function(){var s,d,h,y,v,p,m,g,b,w,x,S,I,N,A,K;return E(this,(function(E){switch(E.label){case 0:return s=new Map(t),""===document.getElementById("user-names").innerText&&(y="W"===e?i:r,document.getElementById("user-names").innerText="↑ "+y+"\n↓ "+f),M?[3,2]:[4,R()];case 1:E.sent(),E.label=2;case 2:if(c.board(s,e,O),W.onclick=function(){return Y(s,e)},n){C.innerText=q?"It's your turn.":"あなたの番です。",z||G("move"),v=function(t,n){var r=!1;Q=new l(n),n.onclick=function(n){var i,o=Q.getCoord(n);if((null===(i=s.get(t+","+String(o)))||void 0===i?void 0:i[0])===e){d=o;var l=new(0,B[s.get(t+","+String(o))[1]])(e,t);c.board(s,e,O),c.dest(l,d,s,a,u),r=!1}else if(!r&&s.has(t+","+String(d))&&(h=o,(l=new(0,B[s.get(t+","+String(d))[1]])(e,t)).validMoves(d,s,a,u).some((function(t){return String(t)===String(h)}))&&("P"===l.abbr&&0===h[1]?r=!0:(z||G("move"),j.emit("move piece",t,d,h)))),c.board(s,e,O),r){for(var f=["N","B","R","Q"],y=2;y<=5;y++)o[0]!==y||3!==o[1]&&4!==o[1]||(r=!1,z||G("move"),j.emit("move piece",t,d,h,f[y-2]));String(o)===String(h)?c.promotion(t,e):(r=!1,d=null)}else d=null}};try{for(p=T(P.entries()),m=p.next();!m.done;m=p.next())g=k(m.value,2),b=g[0],S=g[1],v(b,S)}catch(t){I={error:t}}finally{try{m&&!m.done&&(N=p.return)&&N.call(p)}finally{if(I)throw I.error}}}else{C.innerText=q?"It's your opponent's turn.":"相手の番です。";try{for(w=T(P),x=w.next();!x.done;x=w.next())(S=x.value).onclick=function(){}}catch(t){A={error:t}}finally{try{x&&!x.done&&(K=w.return)&&K.call(w)}finally{if(A)throw A.error}}}return o&&(C.innerHTML=(q?"Check!":"チェック！")+"<br>"+C.innerText,z||G("check")),[2]}}))}))})),j.on("watch",(function(t,e,n,r,i,o){return void 0===o&&(o=!1),I(void 0,void 0,void 0,(function(){var a,l;return E(this,(function(u){switch(u.label){case 0:return"watch"!==s?[3,3]:(a=new Map(t),""===document.getElementById("user-names").innerText&&(document.getElementById("user-names").innerText="↑ "+n+"\n↓ "+e),i&&(C.innerHTML=(q?"Check!":"チェック！")+"<br>"+C.innerText),M?[3,2]:[4,R()]);case 1:u.sent(),u.label=2;case 2:if(c.board(a,"W",O),W.onclick=function(){return Y(a,"W")},o)return[2];l=0===r?e:n,C.innerText=q?"It's "+l+"'s turn.":l+" さんの番です。",z||G("move"),i&&(C.innerHTML=(q?"Check!":"チェック！")+"<br>"+C.innerText,z||G("check")),u.label=3;case 3:return[2]}}))}))})),j.on("tell winner",(function(t){void 0===t?C.innerText=q?"Draw!":"引き分け！":C.innerHTML=(q?"Checkmate!":"チェックメイト！")+"<br>"+(q?t+" won!":t+" の勝ち！"),z||G("win")})),j.on("player discon",(function(t){alert(q?t+"'s connection is closed.":t+" さんの接続が切れました。"),location.reload()})),N.onclick=function(){N.src=z?"../static/svg/volume-up-solid.svg":"../static/svg/volume-mute-solid.svg",N.title=z?q?"Mute":"ミュート":q?"Unmute":"ミュート解除",z=!z};var Y=function(t,e){W.src=O?"../static/svg/eye-slash-regular.svg":"../static/svg/eye-regular.svg",W.title=O?q?"Show pieces in opposite board":"反対側の盤面の駒を表示する":q?"Hide pieces in opposite board":"反対側の盤面の駒を隠す",O=!O,c.board(t,e,O)};document.getElementById("info-icon").onclick=function(){document.getElementById("info-overlay").style.display="flex"},document.getElementById("close-icon").onclick=function(){document.getElementById("info-overlay").style.display="none"},function(t,e){var n=document.getElementById("chat-form"),r=document.getElementById("chat-input"),i=document.getElementById("chat-send-icon");n.addEventListener("submit",(function(e){e.preventDefault(),r.value&&(t.emit("chat message",r.value),r.value="")})),i.onclick=function(){r.value&&(t.emit("chat message",r.value),r.value="")};var o=document.getElementById("chat-messages"),a=document.getElementById("chat"),l=document.getElementById("chat-new");t.on("chat message",(function(t,n,r){var i=document.createElement("li"),u=document.createElement("span");if(u.className="chat-name",u.innerText=r,n){var c=document.createElement("img");c.className="chat-player-icon",c.src="../static/svg/ghost-solid.svg",c.alt="player-icon",c.title=e?"Player":"対戦者",u.appendChild(c)}i.appendChild(u);var s=document.createElement("span");s.innerText=t,i.appendChild(s),o.appendChild(i),o.scrollTop=o.scrollHeight,"closed"===a.className&&(l.className="")})),document.getElementById("chat-btn").onclick=function(){l.className="hidden",a.classList.toggle("closed")}}(j,q)})();